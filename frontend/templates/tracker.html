<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Track a Plan</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <header>
        <nav>
            <a href="{{ url_for('dashboard') }}" class="btn">Dashboard</a>
            <a href="{{ url_for('my_plans') }}" class="btn">My Plans</a>
            <a href="{{ url_for('tracker') }}" class="btn">Tracker</a>
        </nav>
    </header>

    <main>
        <h1>Track a Plan</h1>

        <!-- Plan Selection Dropdown -->
        <form method="GET" action="{{ url_for('tracker') }}">
            <label for="plan_id">Choose a Plan to Track:</label>
            <select name="plan_id" id="plan_id" onchange="this.form.submit()">
                <option value="">-- Select Plan --</option>
                {% for plan in user_plans %}
                    <option value="{{ plan.plan_id }}"
                        {% if selected_plan and selected_plan.plan_id == plan.plan_id %}selected{% endif %}
                    >
                        {{ plan.plan_name }} ({{ plan.plan_type or 'N/A' }})
                    </option>
                {% endfor %}
            </select>
        </form>

        <hr>

        {% if selected_plan %}
            <h2>Plan: {{ selected_plan.plan_name }}</h2>
            <p>Type: {{ selected_plan.plan_type or 'N/A' }}, Duration: {{ selected_plan.plan_duration or 'N/A' }}</p>

            <form method="POST" action="{{ url_for('tracker') }}">
                <!-- Hidden fields to keep track of plan_id and total lifts -->
                <input type="hidden" name="plan_id" value="{{ selected_plan.plan_id }}">
                <input type="hidden" name="total_lifts" value="{{ selected_plan.lifts | length }}">

                <table border="1" cellpadding="5" cellspacing="0">
                    <thead>
                        <tr>
                            <th>Exercise</th>
                            <th>Planned Sets</th>
                            <th>Planned Reps</th>
                            <th>Actual Sets</th>
                            <th>Actual Reps</th>
                            <th>Actual Weight</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for lift in selected_plan.lifts %}
                            <tr>
                                <td>{{ lift.lift_name }}</td>
                                <td>{{ lift.sets }}</td>
                                <td>{{ lift.reps }}</td>

                                <!-- loop.index0 for 0-based indexing -->
                                <input type="hidden" name="plan_lift_id_{{ loop.index0 }}" value="{{ lift.lift_id }}">

                                <td><input type="number" name="actual_sets_{{ loop.index0 }}" min="0"></td>
                                <td><input type="number" name="actual_reps_{{ loop.index0 }}" min="0"></td>
                                <td><input type="number" step="0.1" name="actual_weight_{{ loop.index0 }}" min="0"></td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <br>
                <button type="submit" class="btn">Log Workout</button>
            </form>
        {% else %}
            <p>Please select a plan to track.</p>
        {% endif %}
    </main>

    <footer>
        <p>&copy; 2024 Fitness Friend. All rights reserved.</p>
    </footer>
</body>
</html>
